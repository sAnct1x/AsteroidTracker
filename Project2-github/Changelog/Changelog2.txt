Here is a breakdown of all the changes between the two scripts.

This is a major update. You've successfully replaced the fourth 2D plot (the "Top 25 Hazardous - Next 7 Days") with a new, interactive 3D inner solar system map. When you click on an asteroid in one of the 2D plots, its full orbit is now fetched and drawn on the 3D map.

Here are the specific changes:

1. New Imports and Configuration
New Libraries: You've added import numpy as np, from mpl_toolkits.mplot3d import Axes3D, and import json. These are necessary for the 3D plotting, orbital math, and caching, respectively.

New API Endpoint: You added SBDB_URL = "https://ssd-api.jpl.nasa.gov/sbdb.api". This is a different API from the first one. The first API (cad.api) gets close approach data, while this new one (sbdb.api) gets the full orbital elements for a specific asteroid.

Caching Configuration: You added CACHE_DIR, SBDB_CACHE_DIR, and SBDB_CACHE_TTL_DAYS. This is a smart addition to store the orbital data you fetch from the new SBDB_URL, preventing you from hitting the API every time you click the same asteroid.

2. New Helper Functions
You've added two main categories of new helper functions.

JSON Caching (Lines 150-170):

load_json_cache and save_json_cache: These two functions manage reading and writing the orbital data you fetch to the new cache directory.

Astronomy & Orbit Utilities (Section 3A, Lines 275-475):

This is an entire new section of complex functions to handle the orbital mechanics.

kepler_solve_eccentric_anomaly: The core math function to solve Kepler's equation, which is needed to find an object's position in its orbit.

orbital_elements_to_position_au: Converts an asteroid's 6 orbital elements (like a, e, i) into a 3D (x, y, z) position in space.

try_fetch_sbdb_elements: This is a key function. It takes an asteroid's designation (e.g., "2023 QX"), checks the cache for it, and if it's not there, it calls the new SBDB_URL to get its orbital elements.

build_planet_catalog: A simple function that returns a hard-coded list of orbital data for Mercury, Venus, Earth, and Mars.

log_scale_sizes: A utility to make the planet sizes look reasonable on the 3D plot.

julian_date_utc: Calculates the current date in a format used by astronomers to propagate orbits to the current time.

init_skyfield_if_available & get_planet_positions_au_with_skyfield: These are advanced, optional functions. They try to "softly" import the skyfield library (if you have it installed) to get hyper-accurate current positions for the planets. If not, the code gracefully falls back to using the hard-coded data from build_planet_catalog.

3. Plotting Function (create_and_show_plot)
This is where the most visible changes happened.

Plot Layout Changed (Lines 487-504):

You changed gs = fig.add_gridspec(2, 3, width_ratios=[1, 1.5, 1.5]) to width_ratios=[0.6, 1.0, 1.0]. This makes the left-hand text panel narrower.

The axes_list is now set up differently. The bottom-right axis, axes_list[3], is now created with projection='3d'.

Plot Content Changed (Lines 530-540):

The plot_data_frames list now only has 3 items instead of 4.

You have removed the "Top 25 Hazardous (Next 7 Days)" plot.

The 2x2 grid now contains:

Non-Hazardous (Top-Left)

Hazardous 8-30 Days (Top-Right)

Hazardous 31-180 Days (Bottom-Left)

New 3D Solar System Map (Bottom-Right)

New 3D Plot (Lines 639-729):

This is an entirely new block of code that plots the 3D map.

It plots the Sun, the asteroid belt (as a faint red band), and the planets (Mercury-Mars) using the new astronomy helper functions.

It adds arrows (ax3d.quiver) to the planets to show their direction of travel.

New Interactivity (Lines 544 & 732-817):

Click-Enabled: When creating the 2D scatter plots, you added picker=True (Line 580) and stored their metadata (Line 585).

on_pick Function: You defined a new, large event-handler function named on_pick.

How it works:

When you click a point on a 2D plot, this function fires.

It identifies which asteroid you clicked.

It calls try_fetch_sbdb_elements to get that asteroid's orbital data.

It calculates the orbit path (using orbital_elements_to_position_au).

It removes any previously drawn red orbit from the 3D plot.

It draws the new asteroid's orbit as a red dotted line (with arrows) on the 3D plot.

It automatically resizes the 3D plot's axes to make sure the new orbit fits.

Connecting the Event: The line fig.canvas.mpl_connect('pick_event', on_pick) (Line 819) is what "activates" this new feature.

Text Panel Update (Lines 509-521):

You updated info_text to remove the description of the 4th graph and add a new description for the "3D Solar System Map" and its click-to-plot feature.

Title Position (Line 528):

As I suggested, you changed y=1.0 to y=0.98, moving the title down slightly.

4. Data Pipeline (run_data_pipeline)
No Changes. This entire function is identical to your previous script. It still correctly fetches the close-approach data and creates the four dataframes, three of which are used for the 2D plots.